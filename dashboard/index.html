<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChimeraMetals V3 - Institutional Trading Desk</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #e0e0e0;
            overflow-x: hidden;
            min-height: 100vh;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: 
                radial-gradient(ellipse at 20% 50%, rgba(0, 255, 127, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 50%, rgba(0, 191, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            animation: pulse 8s ease-in-out infinite;
        }
        @keyframes pulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 0.8; } }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }
        header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            font-size: 2.5em;
            font-weight: 300;
            letter-spacing: 2px;
            background: linear-gradient(135deg, #00ff7f, #00bfff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .subtitle { font-size: 0.9em; color: #888; letter-spacing: 1px; }
        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            background: rgba(0, 255, 127, 0.2);
            border: 1px solid rgba(0, 255, 127, 0.3);
            border-radius: 20px;
            font-size: 0.85em;
            margin-top: 15px;
            animation: glow 2s ease-in-out infinite;
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px rgba(0, 255, 127, 0.3); }
            50% { box-shadow: 0 0 20px rgba(0, 255, 127, 0.6); }
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .panel::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 127, 0.5), transparent);
        }
        .panel:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            border-color: rgba(0, 255, 127, 0.2);
        }
        .panel-header {
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #666;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .panel-header::before {
            content: '';
            width: 3px;
            height: 14px;
            background: linear-gradient(180deg, #00ff7f, #00bfff);
            border-radius: 2px;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .metric:last-child { border-bottom: none; }
        .label { font-size: 0.9em; color: #999; }
        .value { font-size: 1.3em; font-weight: 500; font-variant-numeric: tabular-nums; }
        .value.large { font-size: 2.2em; font-weight: 300; }
        .positive { color: #00ff7f; }
        .negative { color: #ff6b6b; }
        .neutral { color: #00bfff; }
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff7f, #00bfff);
            border-radius: 3px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(0, 255, 127, 0.5);
        }
        .connection-status {
            position: fixed;
            top: 20px; right: 20px;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 0.85em;
            z-index: 1000;
        }
        .status-dot {
            display: inline-block;
            width: 8px; height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse-dot 2s infinite;
        }
        .status-dot.connected { background: #00ff7f; box-shadow: 0 0 10px #00ff7f; }
        .status-dot.disconnected { background: #ff6b6b; box-shadow: 0 0 10px #ff6b6b; }
        @keyframes pulse-dot { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .sparkline { width: 100%; height: 60px; margin-top: 12px; }
    </style>
</head>
<body>
    <div class="connection-status">
        <span class="status-dot disconnected" id="statusDot"></span>
        <span id="statusText">CONNECTING...</span>
    </div>
    <div class="container">
        <header>
            <h1>CHIMERAMETALS V3</h1>
            <div class="subtitle">INSTITUTIONAL GRADE TRADING DESK</div>
            <div class="status-badge">⚡ LIVE PRODUCTION</div>
        </header>
        <div class="grid">
            <div class="panel">
                <div class="panel-header">XAU/USD</div>
                <div class="metric">
                    <span class="label">BID</span>
                    <span class="value positive" id="xau-bid">$0.00</span>
                </div>
                <div class="metric">
                    <span class="label">ASK</span>
                    <span class="value neutral" id="xau-ask">$0.00</span>
                </div>
                <canvas class="sparkline" id="xau-sparkline"></canvas>
            </div>
            <div class="panel">
                <div class="panel-header">XAG/USD</div>
                <div class="metric">
                    <span class="label">BID</span>
                    <span class="value positive" id="xag-bid">$0.00</span>
                </div>
                <div class="metric">
                    <span class="label">ASK</span>
                    <span class="value neutral" id="xag-ask">$0.00</span>
                </div>
                <canvas class="sparkline" id="xag-sparkline"></canvas>
            </div>
            <div class="panel">
                <div class="panel-header">HFT ENGINE P&L</div>
                <div class="value large positive" id="hft-pnl">$0.00</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="hft-bar" style="width: 50%"></div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header">STRUCTURE ENGINE P&L</div>
                <div class="value large positive" id="strategy-pnl">$0.00</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="strategy-bar" style="width: 50%"></div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header">EXECUTION LATENCY</div>
                <div class="metric">
                    <span class="label">LAST</span>
                    <span class="value neutral" id="rtt-last">0.00ms</span>
                </div>
                <div class="metric">
                    <span class="label">P50</span>
                    <span class="value" id="rtt-p50">0.00ms</span>
                </div>
                <div class="metric">
                    <span class="label">P95</span>
                    <span class="value" id="rtt-p95">0.00ms</span>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header">STRATEGY STATUS</div>
                <div class="metric">
                    <span class="label">RISK MODE</span>
                    <span class="value positive" id="risk-mode">—</span>
                </div>
                <div class="metric">
                    <span class="label">REGIME</span>
                    <span class="value neutral" id="regime">—</span>
                </div>
                <div class="metric">
                    <span class="label">HFT SIGNAL</span>
                    <span class="value" id="hft-signal">—</span>
                </div>
                <div class="metric">
                    <span class="label">STRUCTURE SIGNAL</span>
                    <span class="value" id="structure-signal">—</span>
                </div>
            </div>
        </div>
    </div>
    <script>
        // FIXED: Force ws:// protocol (not wss://) since server doesn't support SSL
        // Use window.location.hostname to work with any IP/localhost
        const wsUrl = 'ws://' + (window.location.hostname || '185.167.119.59') + ':8080';
        console.log('Connecting to:', wsUrl);
        const ws = new WebSocket(wsUrl);
        
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const xauCanvas = document.getElementById('xau-sparkline');
        const xagCanvas = document.getElementById('xag-sparkline');
        const xauCtx = xauCanvas.getContext('2d');
        const xagCtx = xagCanvas.getContext('2d');
        const xauHistory = [];
        const xagHistory = [];
        const maxHistory = 50;
        
        function drawSparkline(ctx, data, canvas) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (data.length < 2) return;
            const min = Math.min(...data);
            const max = Math.max(...data);
            const range = max - min || 1;
            const step = canvas.width / (data.length - 1);
            ctx.strokeStyle = '#00ff7f';
            ctx.lineWidth = 2;
            ctx.beginPath();
            data.forEach((value, index) => {
                const x = index * step;
                const y = canvas.height - ((value - min) / range) * (canvas.height - 10) - 5;
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();
        }
        
        ws.onopen = () => {
            statusDot.className = 'status-dot connected';
            statusText.textContent = 'LIVE';
            console.log('WebSocket connected');
        };
        
        ws.onclose = () => {
            statusDot.className = 'status-dot disconnected';
            statusText.textContent = 'DISCONNECTED';
            console.log('WebSocket disconnected');
        };
        
        ws.onerror = (error) => {
            console.error('WebSocket error:', error);
        };
        
        ws.onmessage = (event) => {
            try {
                const data = JSON.parse(event.data);
                console.log('Received data:', data);
                
                document.getElementById('xau-bid').textContent = '$' + data.xau_bid.toFixed(2);
                document.getElementById('xau-ask').textContent = '$' + data.xau_ask.toFixed(2);
                document.getElementById('xag-bid').textContent = '$' + data.xag_bid.toFixed(2);
                document.getElementById('xag-ask').textContent = '$' + data.xag_ask.toFixed(2);
                
                const hftPnl = document.getElementById('hft-pnl');
                const stratPnl = document.getElementById('strategy-pnl');
                hftPnl.textContent = '$' + data.hft_pnl.toFixed(2);
                stratPnl.textContent = '$' + data.strategy_pnl.toFixed(2);
                hftPnl.className = 'value large ' + (data.hft_pnl >= 0 ? 'positive' : 'negative');
                stratPnl.className = 'value large ' + (data.strategy_pnl >= 0 ? 'positive' : 'negative');
                
                document.getElementById('hft-bar').style.width = Math.min(100, Math.max(0, 50 + data.hft_pnl / 4)) + '%';
                document.getElementById('strategy-bar').style.width = Math.min(100, Math.max(0, 50 + data.strategy_pnl / 4)) + '%';
                
                document.getElementById('rtt-last').textContent = data.rtt_last.toFixed(2) + 'ms';
                document.getElementById('rtt-p50').textContent = data.rtt_p50.toFixed(2) + 'ms';
                document.getElementById('rtt-p95').textContent = data.rtt_p95.toFixed(2) + 'ms';
                
                document.getElementById('risk-mode').textContent = data.risk_mode;
                document.getElementById('regime').textContent = data.regime;
                document.getElementById('hft-signal').textContent = data.hft_signal;
                document.getElementById('structure-signal').textContent = data.structure_signal;
                
                xauHistory.push(data.xau_bid);
                xagHistory.push(data.xag_bid);
                if (xauHistory.length > maxHistory) xauHistory.shift();
                if (xagHistory.length > maxHistory) xagHistory.shift();
                drawSparkline(xauCtx, xauHistory, xauCanvas);
                drawSparkline(xagCtx, xagHistory, xagCanvas);
            } catch (e) {
                console.error('Error parsing data:', e);
            }
        };
    </script>
</body>
</html>
